- name: "Common set up on all servers"
  hosts: all
  become: true
  any_errors_fatal: true
  tasks:
  - name: Create users
    ansible.builtin.import_role:
      name: ../roles/common/users
    tags:
      - users

  - name: Create host records for servers
    ansible.builtin.import_role:
      name: ../roles/common/hosts
    tags:
      - hosts

  - name: Setup Chrony (NTP client)
    ansible.builtin.import_role:
      name: ../roles/common/chrony
    tags:
      - chrony
      - ntp

  - name: Install benchmarks
    ansible.builtin.import_role:
      name: ../roles/common/benchmarks
    tags:
      - benchmarks

  - name: Harden the system according to lynis recommendations
    ansible.builtin.import_role:
      name: ../roles/common/lynis-hardening
    tags:
      - lynis

  - name: Install ClamAV antivirus
    ansible.builtin.import_role:
      name: ../roles/common/clamav
    tags:
      - clamav

  - name: Configure and secure SSH
    ansible.builtin.import_role:
      name: ../roles/common/ssh
    tags:
      - ssh

  - name: Set up Message-of-the-day
    ansible.builtin.import_role:
      name: ../roles/common/motd
    tags:
      - motd

  - name: Install node-exporter
    ansible.builtin.import_role:
      name: cloudalchemy.node_exporter
    tags:
      - node_exporter
